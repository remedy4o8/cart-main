<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Remedy's Magic Shopping Cart</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <style>
        body {
            background-color: #000; /* Dark background */
        }
        #notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background-color: #d291bc; /* Default light purple */
            color: white;
            padding: 10px;
            border-radius: 10px;
            opacity: 0;
            transition: opacity 0.5s, background-color 0.5s;
            z-index: 1000;
            font-size: 16px;
        }
        .notification-red {
            background-color: #e3342f; /* Red for removal notifications */
        }
        .notification-purple {
            background-color: #d291bc; /* Purple for general notifications */
        }
        .fa-cart-plus, .fa-trash-alt {
            margin-right: 10px;
        }
    </style>
</head>
<body class="text-white">
    <div class="container mx-auto p-4">
        <div class="flex flex-wrap">
            <div class="w-full md:w-2/3">
                <h1 class="text-3xl mb-4 text-teal-400">Let the Shopping Begin!</h1>
                <p class="mb-4">Snag the latest must-haves before anyone else with our early-bird shopping spree! Select your favorites, choose the perfect size, and add them to your cart. Ready to check out? Click 'View Cart' to proceed to the store's website where your items await.</p>
                <div id="products" class="flex flex-wrap justify-start items-stretch gap-4"></div>
            </div>
            <div class="w-full md:w-1/3 sticky top-0" style="height: calc(100vh - 1rem);">
                <div class="overflow-y-auto p-4">
                    <h2 class="text-2xl mb-4 text-lime-300">Shopping Cart</h2>
                    <ul id="cartItems" class="space-y-2"></ul>
                    <button id="cartUrl" class="mt-4 bg-purple-500 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded hidden">View Cart</button>
                    <p id="cartUrlDisplay" class="mt-2 text-sm hidden"></p>
                </div>
            </div>
        </div>
    </div>
    <div id="notification"><i class="fas fa-info-circle"></i> <span id="notificationText"></span></div>
    <script>
        const shopUrl = "https://littlesleepies.com";
        async function fetchProducts(url) {
            try {
                const response = await fetch(url);
                if (!response.ok) throw new Error(`HTTP error! Status: ${response.status}`);
                const data = await response.json();
                displayProducts(data);
            } catch (error) {
                console.error('Error fetching data:', error);
                document.getElementById('products').innerHTML = `<div class="text-red-500 p-4">Error fetching products: ${error.message}</div>`;
            }
        }

        function displayProducts(data) {
            const container = document.getElementById('products');
            if (!data.products || data.products.length === 0) {
                container.innerHTML = '<div class="p-4">No Products Found.</div>';
                return;
            }

            // Sort to bring any product with "Dreams Large Cloud Blanket" or "zippy" in the title to the front
            data.products.sort((a, b) => {
                const keyPhrases = ["dreams large cloud blanket", "zippy"]; // Lowercase phrases for comparison
                const aScore = scoreProduct(a.title, keyPhrases);
                const bScore = scoreProduct(b.title, keyPhrases);
                return aScore - bScore;
            });

            data.products.forEach(product => {
                const productElement = document.createElement('div');
                productElement.className = 'w-full sm:w-1/2 md:w-1/4 p-4';
                const firstImageSrc = product.images[0] ? product.images[0].src : 'placeholder.jpg';
                productElement.innerHTML = `
                    <div class="bg-gray-800 rounded overflow-hidden shadow-lg">
                        <img class="w-full h-48 object-cover" src="${firstImageSrc}" alt="${product.title}">
                        <div class="p-4">
                            <div class="font-bold text-xl mb-2">${product.title} $${product.variants[0].price}</div>
                            <div class="flex flex-wrap gap-2"></div>
                        </div>
                    </div>`;
                const variantsGrid = productElement.querySelector('.flex-wrap');
                product.variants.forEach(variant => {
                    const variantButton = document.createElement('button');
                    variantButton.className = 'bg-pink-500 hover:bg-pink-700 text-white font-bold py-2 px-4 rounded';
                    variantButton.textContent = variant.option1;
                    variantButton.onclick = () => addVariantToCart(product.title, variant.id, variant.option1, variant.option2, firstImageSrc);
                    variantsGrid.appendChild(variantButton);
                });
                container.appendChild(productElement);
            });
        }

        function scoreProduct(title, keyPhrases) {
            // Lower index in keyPhrases array means higher priority
            let score = keyPhrases.length; // Initialize with a value larger than any index
            keyPhrases.forEach((phrase, index) => {
                if (title.toLowerCase().includes(phrase)) {
                    score = Math.min(score, index); // Assign the lowest index found
                }
            });
            return score;
        }

        let cartItems = [];

        function addVariantToCart(title, variantId, size, color, imageUrl) {
            cartItems.push({ title, variantId, size, color, imageUrl });
            updateCartList();
            displayNotification('Added', `Added to cart: ${title}`, 'purple');
        }

        function removeItemFromCart(index) {
            cartItems.splice(index, 1); // Remove the item from the array
            updateCartList(); // Update the display list
            displayNotification('Removed', 'Item removed from cart.', 'red'); // Show notification
        }

        function updateCartList() {
            const cartList = document.getElementById('cartItems');
            cartList.innerHTML = cartItems.map((item, index) => `
                <li class="bg-gray-800 p-2 rounded flex justify-between items-center">
                    <div class="flex items-center">
                        <img src="${item.imageUrl}" class="w-10 h-10 rounded-full" alt="Product">
                        <div class="ml-4">
                            <p class="text-sm font-medium">${item.title}</p>
                            <p class="text-xs text-gray-400">Size: ${item.size}</p>
                        </div>
                    </div>
                    <button class="bg-red-500 hover:bg-red-700 text-white font-bold py-1 px-2 rounded" onclick="removeItemFromCart(${index})">Remove</button>
                </li>`).join('');
            toggleCartVisibility();
        }

        function toggleCartVisibility() {
            const cartLink = document.getElementById('cartUrl');
            const cartUrlDisplay = document.getElementById('cartUrlDisplay');
            if (cartItems.length > 0) {
                cartLink.classList.remove('hidden');
                cartUrlDisplay.classList.remove('hidden');
                const encodedItems = cartItems.map(item => `${item.variantId}:1`).join(',');
                const cartUrl = `${shopUrl}/cart/${encodedItems}`;
                // cartUrlDisplay.innerText = cartUrl;
                cartLink.onclick = () => window.open(cartUrl, '_blank');
            } else {
                cartLink.classList.add('hidden');
                cartUrlDisplay.classList.add('hidden');
            }
        }

        function displayNotification(action, message, color) {
            const notificationElement = document.getElementById('notification');
            notificationElement.style.opacity = 1;
            document.getElementById('notificationText').innerText = message;
            // Apply color based on action
            if (color === 'red') {
                notificationElement.classList.add('notification-red');
                notificationElement.classList.remove('notification-purple');
            } else {
                notificationElement.classList.add('notification-purple');
                notificationElement.classList.remove('notification-red');
            }
            setTimeout(() => notificationElement.style.opacity = 0, 2500);
        }

        document.addEventListener('DOMContentLoaded', () => fetchProducts('https://littlesleepies.com/collections/vip-early-access/products.json'));
    </script>
</body>
</html>
