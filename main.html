<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Enhanced Shopping Cart</title>
<link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
<style>
    body {
        background-color: #000; /* Dark background */
    }

    /* Hide the dot from <li> elements */
    .py-1.variant  {
        list-style-type: none;
    }
</style>
</head>
<body class="text-white">
<div class="container mx-auto mt-8">
    <div class="flex flex-row">
        <div class="w-2/3">
            <h1 class="text-3xl mb-4">Welcome to Andy's Secret Shopping Cart</h1>
            <div id="products" class="flex flex-wrap"></div>
        </div>
        <div class="w-1/3 sticky top-0" style="height: calc(100vh - 2rem);">
            <div class="overflow-y-auto px-4">
                <h2 class="text-2xl mb-4">Shopping Cart</h2>
                <ul id="cartItems" class="list-none"></ul>
                <button id="cartUrl" class="mt-4 bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline">View Cart</button>
                <p class="mt-4 text-sm" id="cartUrlDisplay"></p>
            </div>
        </div>
    </div>
</div>

<script>
    const shopUrl = "https://www.100percentpure.com/";

    async function fetchProducts(url) {
        try {
            const response = await fetch(url);
            if (!response.ok) {
                throw new Error(`HTTP error! Status: ${response.status}`);
            }
            const data = await response.json();
            displayProducts(data);
        } catch (error) {
            console.error('Error fetching data:', error);
            document.getElementById('products').innerHTML = `<div class="w-full p-4 text-red-500">Error fetching products: ${error.message}</div>`;
        }
    }

    function displayProducts(data) {
        const container = document.getElementById('products');
        if (!data.products || data.products.length === 0) {
            container.innerHTML = '<div class="w-full p-4">No products found.</div>';
            return;
        }

        data.products.forEach(product => {
            const productElement = document.createElement('div');
            productElement.className = 'w-1/4 p-4';
            const firstImageSrc = product.images[0] ? product.images[0].src : 'placeholder.jpg';
            productElement.innerHTML = `
                <div class="bg-gray-800 rounded overflow-hidden shadow-lg">
                    <img class="w-full h-48 object-cover" src="${firstImageSrc}" alt="Image of ${product.title}">
                    <div class="px-6 py-4">
                        <div class="font-bold text-xl mb-2">${product.title} $${product.variants[0].price}</div>
                        <ul class="list-none">`;
            product.variants.forEach(variant => {
                productElement.innerHTML += `
                    <li class="py-1 variant">
                        <button class="bg-pink-500 hover:bg-pink-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline" onclick="addVariantToCart('${product.title}', '${variant.id}', '${variant.option1}', '${variant.option2}', '${firstImageSrc}')">
                            ${variant.option1}
                        </button>
                    </li>`;
            });
            productElement.innerHTML += `
                        </ul>
                    </div>
                </div>`;
            container.appendChild(productElement);
        });
    }

    let cartItems = [];
    function addVariantToCart(title, variantId, size, color, imageUrl) {
        const item = { title, variantId, size, color, imageUrl };
        cartItems.push(item);
        updateCartList();
        updateCartUrl();
    }

    function removeItemFromCart(index) {
        cartItems.splice(index, 1);
        updateCartList();
        updateCartUrl();
    }

    function updateCartList() {
        const cartList = document.getElementById('cartItems');
        cartList.innerHTML = '';
        cartItems.forEach((item, index) => {
            const listItem = document.createElement('li');
            listItem.className = 'bg-gray-800 px-4 py-2 rounded mt-1 flex justify-between items-center';
            listItem.innerHTML = `
                <div class="flex items-center">
                    <img src="${item.imageUrl}" class="w-10 h-10 object-cover rounded-full" alt="Product Image">
                    <div class="ml-4">
                        <p class="text-sm font-medium text-gray-100">${item.title}</p>
                        <p class="text-sm text-gray-400">Size: ${item.size}</p>
                    </div>
                </div>
                <button class="bg-red-500 hover:bg-red-700 text-white font-bold py-1 px-2 rounded" onclick="removeItemFromCart(${index})">Remove</button>`;
            cartList.appendChild(listItem);
        });
    }

    function updateCartUrl() {
        const encodedItems = cartItems.map(item => encodeURIComponent(`${item.variantId}:1`)).join(',');
        const cartUrl = `${shopUrl}/cart/${encodedItems}?discount=LSVIP`;
        const cartLink = document.getElementById('cartUrl');
        cartLink.onclick = () => window.open(cartUrl, '_blank');
        document.getElementById('cartUrlDisplay').innerText = cartUrl;
    }

    fetchProducts('https://www.100percentpure.com/collections/new/products.json');
</script>
</body>
</html>
