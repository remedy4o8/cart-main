<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Remedy's Magic Shopping Cart</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <style>
        body {
            background-color: #000; /* Dark background */
        }
        /* Hide the dot from <li> elements */
        .py-1.variant {
            list-style-type: none;
            padding: 4px;
        }
        .variants-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 4px;
        }
        #notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background-color: #d291bc; /* Cute light purple */
            color: white;
            padding: 10px;
            border-radius: 10px;
            opacity: 0;
            transition: opacity 0.5s;
            z-index: 1000;
            font-size: 16px;
        }
        .fa-cart-plus, .fa-trash-alt {
            margin-right: 10px;
        }
    </style>
</head>
<body class="text-white">
    <div class="container mx-auto mt-8">
        <div class="flex flex-row">
            <div class="w-2/3">
                <strong><h1 class="text-3xl mb-4" style="color: #008080;">Let the Shopping Begin!</h1></strong>
                <p>Snag the latest must-haves before anyone else with our early-bird shopping spree! Simply choose your favorites, select the perfect size, and toss them into your cart. Once you're all set, hit 'View Cart' to magically teleport to the actual store's website—voilà! Everything you picked is ready to go. Just a friendly heads-up: hold off on hitting that checkout button too soon, or you might just miss out!</p>
                <div id="products" class="flex flex-wrap"></div>
            </div>
            <div class="w-1/3 sticky top-0" style="height: calc(100vh - 2rem);">
                <div class="overflow-y-auto px-4">
                    <strong><h2 class="text-2xl mb-4" style="color: #98FF98;">Shopping Cart</h2></strong>
                    <ul id="cartItems" class="list-none"></ul>
                    <button id="cartUrl" class="mt-4 bg-purple-500 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline">View Cart</button>
                    <p class="mt-4 text-sm" id="cartUrlDisplay"></p>
                </div>
            </div>
        </div>
    </div>
    <div id="notification"><i class="fas fa-info-circle"></i> <span id="notificationText"></span></div>
    <script>
        const shopUrl = "https://littlesleepies.com/";
        async function fetchProducts(url) {
            try {
                const response = await fetch(url);
                if (!response.ok) throw new Error(`HTTP error! Status: ${response.status}`);
                const data = await response.json();
                displayProducts(data);
            } catch (error) {
                console.error('Error fetching data:', error);
                document.getElementById('products').innerHTML = `<div class="w-full p-4 text-red-500">Error fetching products: ${error.message}</div>`;
            }
        }

        function displayProducts(data) {
            const container = document.getElementById('products');
            if (!data.products || data.products.length === 0) {
                container.innerHTML = '<div class="w-full p-4">No Products Found. =[ </div>';
                return;
            }
            // Sort to bring any product with "Dreams Large Cloud Blanket" or "zippy" in the title to the front
            data.products.sort((a, b) => {
                const keyPhrases = ["Dreams Large Cloud Blanket", "zippy"];
                const aIncludes = keyPhrases.some(phrase => a.title.includes(phrase));
                const bIncludes = keyPhrases.some(phrase => b.title.includes(phrase));
                if (aIncludes && !bIncludes) return -1;
                if (!aIncludes && bIncludes) return 1;
                return 0;
            });
            data.products.forEach(product => {
                const productElement = document.createElement('div');
                productElement.className = 'w-1/4 p-4';
                const firstImageSrc = product.images[0] ? product.images[0].src : 'placeholder.jpg';
                productElement.innerHTML = `
                    <div class="bg-gray-800 rounded overflow-hidden shadow-lg">
                        <img class="w-full h-48 object-cover" src="${firstImageSrc}" alt="Image of ${product.title}">
                        <div class="px-6 py-4">
                            <div class="font-bold text-xl mb-2">${product.title} $${product.variants[0].price}</div>
                            <div class="variants-grid">`;
                product.variants.forEach(variant => {
                    productElement.innerHTML += `
                        <div class="py-1 variant">
                            <button class="bg-pink-500 hover:bg-pink-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline" onclick="addVariantToCart('${product.title}', '${variant.id}', '${variant.option1}', '${variant.option2}', '${firstImageSrc}')">
                                ${variant.option1}
                            </button>
                        </div>`;
                });
                productElement.innerHTML += `</div></div></div>`;
                container.appendChild(productElement);
            });
        }

        let cartItems = [];

        function addVariantToCart(title, variantId, size, color, imageUrl) {
            const item = { title, variantId, size, color, imageUrl };
            cartItems.push(item);
            updateCartList();
            updateCartUrl();
            displayNotification('Added', `Added to cart: ${title}`);
        }

        function removeItemFromCart(index) {
            const itemTitle = cartItems[index].title;
            cartItems.splice(index, 1);
            updateCartList();
            updateCartUrl();
            displayNotification('Removed', `Removed from cart: ${itemTitle}`);
        }

        function updateCartList() {
            const cartList = document.getElementById('cartItems');
            cartList.innerHTML = '';
            cartItems.forEach((item, index) => {
                const listItem = document.createElement('li');
                listItem.className = 'bg-gray-800 px-4 py-2 rounded mt-1 flex justify-between items-center';
                listItem.innerHTML = `
                    <div class="flex items-center">
                        <img src="${item.imageUrl}" class="w-10 h-10 object-cover rounded-full" alt="Product Image">
                        <div class="ml-4">
                            <p class="text-sm font-medium text-gray-100">${item.title}</p>
                            <p class="text-sm text-gray-400">Size: ${item.size}</p>
                        </div>
                    </div>
                    <button class="bg-red-500 hover:bg-red-700 text-white font-bold py-1 px-2 rounded" onclick="removeItemFromCart(${index})">Remove</button>`;
                cartList.appendChild(listItem);
            });
        }

        function updateCartUrl() {
            const encodedItems = cartItems.map(item => encodeURIComponent(`${item.variantId}:1`)).join(',');
            let cartUrl = `${shopUrl}/cart/${encodedItems}`;
            if (shopUrl.includes('littlesleepies.com')) {
                cartUrl += '?discount=lsvip';
            }
            const cartLink = document.getElementById('cartUrl');
            cartLink.onclick = () => window.open(cartUrl, '_blank');
            document.getElementById('cartUrlDisplay').innerText = cartUrl;
        }

        function displayNotification(action, message) {
            const notificationElement = document.getElementById('notification');
            const notificationText = document.getElementById('notificationText');
            notificationText.innerText = message;
            notificationElement.style.opacity = 1;
            setTimeout(() => {
                notificationElement.style.opacity = 0;
            }, 2500); // Fade out after 2.5 seconds
        }

        fetchProducts('https://littlesleepies.com/collections/vip-early-access/products.json');
    </script>
</body>
</html>
